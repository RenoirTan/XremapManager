#!/bin/sh

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@

function err() {
    echo -e "\e[31mERR:\e[0m" $@
}

MGR_ROOT=$(dirname $0)

XRMP_CONFIG_FILE="${XDG_CONFIG_HOME:-$HOME/.config}/xremapmanager.json"
if [ ! -f "$XRMP_CONFIG_FILE" ]; then
    cp "$MGR_ROOT/xremapmanager.json" "$XRMP_CONFIG_FILE"
fi

XREMAP=$(jq -r .command.path $XRMP_CONFIG_FILE)
XREMAP="${XREMAP:-xremap}"
if ! 2>/dev/null 1>&2 which $XREMAP; then
    err "Could not find ${XREMAP}"
    exit 1
fi

REMAP_CONFIG=$(jq -r .layout $XRMP_CONFIG_FILE)

$XREMAP "$REMAP_CONFIG"